// Datastar Core v1.0.0-RC.7
var Y=/ðŸ–•JS_DSðŸš€/.source,K=Y.slice(0,5),j=Y.slice(4),ee="datastar-fetch",te="datastar-signal-patch";var g=Object.hasOwn??Object.prototype.hasOwnProperty.call;var v=e=>e!==null&&typeof e=="object"&&(Object.getPrototypeOf(e)===Object.prototype||Object.getPrototypeOf(e)===null);var _=e=>{let t={};for(let[n,i]of e){let s=n.split("."),o=s.pop(),r=s.reduce((a,c)=>a[c]??={},t);r[o]=i}return t};var M=[],W=[],C=0,E=0,J=0,z,p,L=0,$=()=>{C++},D=()=>{--C||(ie(),m())},G=e=>{z=p,p=e},V=()=>{p=z,z=void 0},x=e=>Pe.bind(0,{previousValue:e,t:e,e:1}),U=Symbol("computed"),xe=e=>{let t=Fe.bind(0,{e:17,getter:e});return t[U]=1,t},Te=e=>{let t={d:e,e:2};p&&Q(t,p),G(t),$();try{t.d()}finally{D(),V()}return ce.bind(0,t)},ie=()=>{for(;E<J;){let e=W[E];W[E++]=void 0,ae(e,e.e&=-65)}E=0,J=0},ne=e=>"getter"in e?re(e):oe(e,e.t),re=e=>{G(e),le(e);try{let t=e.t;return t!==(e.t=e.getter(t))}finally{V(),fe(e)}},oe=(e,t)=>(e.e=1,e.previousValue!==(e.previousValue=t)),B=e=>{let t=e.e;if(!(t&64)){e.e=t|64;let n=e.s;n?B(n.o):W[J++]=e}},ae=(e,t)=>{if(t&16||t&32&&ue(e.i,e)){G(e),le(e),$();try{e.d()}finally{D(),V(),fe(e)}return}t&32&&(e.e=t&-33);let n=e.i;for(;n;){let i=n.c,s=i.e;s&64&&ae(i,i.e=s&-65),n=n.r}},Pe=(e,...t)=>{if(t.length){if(e.t!==(e.t=t[0])){e.e=17;let i=e.s;return i&&(we(i),C||ie()),!0}return!1}let n=e.t;if(e.e&16&&oe(e,n)){let i=e.s;i&&k(i)}return p&&Q(e,p),n},Fe=e=>{let t=e.e;if(t&16||t&32&&ue(e.i,e)){if(re(e)){let n=e.s;n&&k(n)}}else t&32&&(e.e=t&-33);return p&&Q(e,p),e.t},ce=e=>{let t=e.i;for(;t;)t=O(t,e);let n=e.s;n&&O(n),e.e=0},Q=(e,t)=>{let n=t.a;if(n&&n.c===e)return;let i=n?n.r:t.i;if(i&&i.c===e){i.g=L,t.a=i;return}let s=e.p;if(s&&s.g===L&&s.o===t)return;let o=t.a=e.p={g:L,c:e,o:t,l:n,r:i,f:s};i&&(i.l=o),n?n.r=o:t.i=o,s?s.n=o:e.s=o},O=(e,t=e.o)=>{let n=e.c,i=e.l,s=e.r,o=e.n,r=e.f;if(s?s.l=i:t.a=i,i?i.r=s:t.i=s,o?o.f=r:n.p=r,r)r.n=o;else if(!(n.s=o))if("getter"in n){let a=n.i;if(a){n.e=17;do a=O(a,n);while(a)}}else"previousValue"in n||ce(n);return s},we=e=>{let t=e.n,n;e:for(;;){let i=e.o,s=i.e;if(s&60?s&12?s&4?!(s&48)&&_e(e,i)?(i.e=s|40,s&=1):s=0:i.e=s&-9|32:s=0:i.e=s|32,s&2&&B(i),s&1){let o=i.s;if(o){let r=(e=o).n;r&&(n={t,u:n},t=r);continue}}if(e=t){t=e.n;continue}for(;n;)if(e=n.t,n=n.u,e){t=e.n;continue e}break}},le=e=>{L++,e.a=void 0,e.e=e.e&-57|4},fe=e=>{let t=e.a,n=t?t.r:e.i;for(;n;)n=O(n,e);e.e&=-5},ue=(e,t)=>{let n,i=0,s=!1;e:for(;;){let o=e.c,r=o.e;if(t.e&16)s=!0;else if((r&17)===17){if(ne(o)){let a=o.s;a.n&&k(a),s=!0}}else if((r&33)===33){(e.n||e.f)&&(n={t:e,u:n}),e=o.i,t=o,++i;continue}if(!s){let a=e.r;if(a){e=a;continue}}for(;i--;){let a=t.s,c=a.n;if(c?(e=n.t,n=n.u):e=a,s){if(ne(t)){c&&k(a),t=e.o;continue}s=!1}else t.e&=-33;if(t=e.o,e.r){e=e.r;continue e}}return s}},k=e=>{do{let t=e.o,n=t.e;(n&48)===32&&(t.e=n|16,n&2&&B(t))}while(e=e.n)},_e=(e,t)=>{let n=t.a;for(;n;){if(n===e)return!0;n=n.l}return!1},de=e=>{let t=R,n=e.split(".");for(let i of n){if(t==null||!g(t,i))return;t=t[i]}return t},N=(e,t="")=>{let n=Array.isArray(e);if(n||v(e)){let i=n?[]:{};for(let o in e)i[o]=x(N(e[o],`${t+o}.`));let s=x(0);return new Proxy(i,{get(o,r){if(!(r==="toJSON"&&!g(i,r)))return n&&r in Array.prototype?(s(),i[r]):typeof r=="symbol"?i[r]:((!g(i,r)||i[r]()==null)&&(i[r]=x(""),m(t+r,""),s(s()+1)),i[r]())},set(o,r,a){let c=t+r;if(n&&r==="length"){let l=i[r]-a;if(i[r]=a,l>0){let f={};for(let u=a;u<i[r];u++)f[u]=null;m(t.slice(0,-1),f),s(s()+1)}}else if(g(i,r))if(a==null)delete i[r];else if(g(a,U))i[r]=a,m(c,"");else{let l=i[r](),f=`${c}.`;if(v(l)&&v(a)){for(let u in l)g(a,u)||(delete l[u],m(f+u,null));for(let u in a){let d=a[u];l[u]!==d&&(l[u]=d)}}else i[r](N(a,f))&&m(c,a)}else a!=null&&(g(a,U)?(i[r]=a,m(c,"")):(i[r]=x(N(a,`${c}.`)),m(c,a)),s(s()+1));return!0},deleteProperty(o,r){return delete i[r],s(s()+1),!0},ownKeys(){return s(),Reflect.ownKeys(i)},has(o,r){return s(),r in i}})}return e},m=(e,t)=>{if(e!==void 0&&t!==void 0&&M.push([e,t]),!C&&M.length){let n=_(M);M.length=0,document.dispatchEvent(new CustomEvent(te,{detail:n}))}},ge=(e,{ifMissing:t}={})=>{$();for(let n in e)e[n]==null?t||delete R[n]:pe(e[n],n,R,"",t);D()},Me=(e,t)=>ge(_(e),t),pe=(e,t,n,i,s)=>{if(v(e)){g(n,t)&&(v(n[t])||Array.isArray(n[t]))||(n[t]={});for(let o in e)e[o]==null?s||delete n[t][o]:pe(e[o],o,n[t],`${i+t}.`,s)}else s&&g(n,t)||(n[t]=e)},se=e=>typeof e=="string"?RegExp(e.replace(/^\/|\/$/g,"")):e,Ee=({include:e=/.*/,exclude:t=/(?!)/}={},n=R)=>{let i=se(e),s=se(t),o=[],r=[[n,""]];for(;r.length;){let[a,c]=r.pop();for(let l in a){let f=c+l;v(a[l])?r.push([a[l],`${f}.`]):i.test(f)&&!s.test(f)&&o.push([f,de(f)])}}return _(o)},R=N({});var T=e=>e instanceof HTMLElement||e instanceof SVGElement||e instanceof MathMLElement;var Le=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").replace(/([a-z])([0-9]+)/gi,"$1-$2").replace(/([0-9]+)([a-z])/gi,"$1-$2").replace(/[\s_]+/g,"-").toLowerCase();var ye=e=>Le(e).replace(/-/g,"_");var me=e=>`data-${e}`;var Ne="https://data-star.dev/errors",P=(e,t,n={})=>{Object.assign(n,e);let i=new Error,s=ye(t),o=new URLSearchParams({metadata:JSON.stringify(n)}).toString(),r=JSON.stringify(n,null,2);return i.message=`${t}
More info: ${Ne}/${s}?${o}
Context: ${r}`,i},F=new Map,Z=new Map,Re=new Map,he=new Proxy({},{get:(e,t)=>F.get(t)?.apply,has:(e,t)=>F.has(t),ownKeys:()=>Reflect.ownKeys(F),set:()=>!1,deleteProperty:()=>!1}),w=new Map,q=[],X=new Set,Oe=new WeakSet,ke=e=>{q.push(e),q.length===1&&setTimeout(()=>{for(let t of q)X.add(t.name),Z.set(t.name,t);q.length=0,He(),X.clear()})},Ce=e=>{F.set(e.name,e)};document.addEventListener(ee,e=>{let t=Re.get(e.detail.type);t&&t.apply({error:P.bind(0,{plugin:{type:"watcher",name:t.name},element:{id:e.target.id,tag:e.target.tagName}})},e.detail.argsRaw)});var $e=e=>{Re.set(e.name,e)},ve=e=>{for(let t of e){let n=w.get(t);if(n&&w.delete(t))for(let i of n.values())for(let s of i.values())s()}},Ae=me("ignore"),De=`[${Ae}]`,be=e=>e.hasAttribute(`${Ae}__self`)||!!e.closest(De),H=(e,t)=>{for(let n of e)if(!be(n))for(let i in n.dataset)Se(n,i.replace(/[A-Z]/g,"-$&").toLowerCase(),n.dataset[i],t)},Ge=e=>{for(let{target:t,type:n,attributeName:i,addedNodes:s,removedNodes:o}of e)if(n==="childList"){for(let r of o)T(r)&&(ve([r]),ve(r.querySelectorAll("*")));for(let r of s)T(r)&&(H([r]),H(r.querySelectorAll("*")))}else if(n==="attributes"&&i.startsWith("data-")&&T(t)&&!be(t)){let r=i.slice(5),a=t.getAttribute(i);if(a===null){let c=w.get(t);if(c){let l=c.get(r);if(l){for(let f of l.values())f();c.delete(r)}}}else Se(t,r,a)}},Ve=new MutationObserver(Ge),qe=e=>{let[t,...n]=e.split("__"),[i,s]=t.split(/:(.+)/),o=new Map;for(let r of n){let[a,...c]=r.split(".");o.set(a,new Set(c))}return{pluginName:i,key:s,mods:o}};var He=(e=document.documentElement,t=!0)=>{T(e)&&H([e],!0),H(e.querySelectorAll("*"),!0),t&&(Ve.observe(e,{subtree:!0,childList:!0,attributes:!0}),Oe.add(e))},Se=(e,t,n,i)=>{{let s=t,{pluginName:o,key:r,mods:a}=qe(s),c=Z.get(o);if((!i||X.has(o))&&c){let l={el:e,rawKey:s,mods:a,error:P.bind(0,{plugin:{type:"attribute",name:c.name},element:{id:e.id,tag:e.tagName},expression:{rawKey:s,key:r,value:n}}),key:r,value:n,loadedPluginNames:{actions:new Set(F.keys()),attributes:new Set(Z.keys())},rx:void 0},f=c.requirement&&(typeof c.requirement=="string"?c.requirement:c.requirement.key)||"allowed",u=c.requirement&&(typeof c.requirement=="string"?c.requirement:c.requirement.value)||"allowed",d=r!=null&&r!=="",h=n!=null&&n!=="";if(d){if(f==="denied")throw l.error("KeyNotAllowed")}else if(f==="must")throw l.error("KeyRequired");if(h){if(u==="denied")throw l.error("ValueNotAllowed")}else if(u==="must")throw l.error("ValueRequired");if(f==="exclusive"||u==="exclusive"){if(d&&h)throw l.error("KeyAndValueProvided");if(!d&&!h)throw l.error("KeyOrValueRequired")}let b=new Map;if(h){let A;l.rx=(...I)=>(A||(A=Ie(n,{returnsValue:c.returnsValue,argNames:c.argNames,cleanups:b})),A(e,...I))}let S=c.apply(l);S&&b.set("attribute",S);let y=w.get(e);if(y){let A=y.get(s);if(A)for(let I of A.values())I()}else y=new Map,w.set(e,y);y.set(s,b)}}},Ie=(e,{returnsValue:t=!1,argNames:n=[],cleanups:i=new Map}={})=>{let s="";if(t){let c=/(\/(\\\/|[^/])*\/|"(\\"|[^"])*"|'(\\'|[^'])*'|`(\\`|[^`])*`|\(\s*((function)\s*\(\s*\)|(\(\s*\))\s*=>)\s*(?:\{[\s\S]*?\}|[^;){]*)\s*\)\s*\(\s*\)|[^;])+/gm,l=e.trim().match(c);if(l){let f=l.length-1,u=l[f].trim();u.startsWith("return")||(l[f]=`return (${u});`),s=l.join(`;
`)}}else s=e.trim();let o=new Map,r=RegExp(`(?:${K})(.*?)(?:${j})`,"gm"),a=0;for(let c of s.matchAll(r)){let l=c[1],f=`__escaped${a++}`;o.set(f,l),s=s.replace(K+l+j,f)}s=s.replace(/\$\['([a-zA-Z_$\d][\w$]*)'\]/g,"$$$1").replace(/\$([a-zA-Z_\d]\w*(?:[.-]\w+)*)/g,(c,l)=>l.split(".").reduce((f,u)=>`${f}['${u}']`,"$")),s=s.replaceAll(/@([A-Za-z_$][\w$]*)\(/g,'__action("$1",evt,');for(let[c,l]of o)s=s.replace(c,l);try{let c=Function("el","$","__action","evt",...n,s);return(l,...f)=>{let u=(d,h,...b)=>{let S=P.bind(0,{plugin:{type:"action",name:d},element:{id:l.id,tag:l.tagName},expression:{fnContent:s,value:e}}),y=he[d];if(y)return y({el:l,evt:h,error:S,cleanups:i},...b);throw S("UndefinedAction")};try{return c(l,R,u,void 0,...f)}catch(d){throw console.error(d),P({element:{id:l.id,tag:l.tagName},expression:{fnContent:s,value:e},error:d.message},"ExecuteExpression")}}}catch(c){throw console.error(c),P({expression:{fnContent:s,value:e},error:c.message},"GenerateExpression")}};export{Ce as action,he as actions,ke as attribute,$ as beginBatch,xe as computed,Te as effect,D as endBatch,Ee as filtered,de as getPath,ge as mergePatch,Me as mergePaths,R as root,x as signal,G as startPeeking,V as stopPeeking,$e as watcher};
//# sourceMappingURL=datastar-core.js.map
